// --- YOUTUBE API KURULUMU ---
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player;
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '360',
        width: '100%',
        videoId: '', // BaÅŸlangÄ±Ã§ta boÅŸ
        host: 'https://www.youtube.com', // BU SATIR HATA Ä°Ã‡Ä°N Ã–NEMLÄ°
        playerVars: {
            'playsinline': 1,
            'origin': window.location.origin, // Domain gÃ¼venliÄŸi
            'rel': 0, // Ã–nerilen videolarÄ± kapat
            'modestbranding': 1
        },
        events: {
            'onStateChange': onPlayerStateChange,
            'onError': onPlayerError
        }
    });
}

function onPlayerError(event) {
    console.error("YouTube Player HatasÄ±:", event.data);
    // Hata kodlarÄ±na gÃ¶re kullanÄ±cÄ±ya bilgi verilebilir ama ÅŸimdilik konsola yazdÄ±rdÄ±k.
}

function onPlayerStateChange(event) {
    // Sadece videoyu baÅŸlatan kiÅŸi komut gÃ¶ndersin diye kontrol eklenebilir
    // Ama ÅŸimdilik herkesin durumu senkronize olsun:
    if (event.data == YT.PlayerState.PLAYING) {
        socket.emit('yt-sync', { action: 'play', time: player.getCurrentTime() });
    } else if (event.data == YT.PlayerState.PAUSED) {
        socket.emit('yt-sync', { action: 'pause', time: player.getCurrentTime() });
    }
}

// --- DÄ°ÄžER FONKSÄ°YONLAR ---

if(window.visualViewport){window.visualViewport.addEventListener('resize',()=>{document.documentElement.style.setProperty('--app-height',`${window.visualViewport.height}px`);scrollToBottom()});document.documentElement.style.setProperty('--app-height',`${window.visualViewport.height}px`)}
function isMobile(){return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}
if(isMobile())document.getElementById('screen-share-btn').style.display='none';

const socket=io();
let myPeer,myPeerId,cameraStream=null,screenStream=null,currentActiveStream=null;
let myNickname="";
const ROOM_ID="ozel-oda-v1";

const videoGrid=document.getElementById('video-grid');
const activeCalls={};
const videoElements={};
const userStreams={};
let connectedPeerIds=[]; 
let userStatusMap={};

const myVideo=document.createElement('video');
myVideo.muted=true;
myVideo.setAttribute('playsinline','');
myVideo.autoplay=true;
myVideo.className='camera-mode';

const notifyAudio = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAFAAAAZgAdf39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f38AAAAATGF2YzU4LjkxLjEwMAAAAAAAAAAAAAAA//uQZAAP8AAAaQAAAADXAAaQAAAA0gAAABpAAABpAAAAGkAAAGkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJ/8z8AABpA/8z8AABpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQZAAP8AAAaQAAAADXAAaQAAAA0gAAABpAAABpAAAAGkAAAGkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJ/8z8AABpA/8z8AABpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA");
if("Notification" in window) Notification.requestPermission();

window.onload=()=>{
    const u=localStorage.getItem('chat_user');
    const p=localStorage.getItem('chat_pass');
    if(u&&p)socket.emit('login',u,p); 
    toggleInputButtons();
};

function getEmptyStream(){const c=document.createElement('canvas');c.width=1;c.height=1;const s=c.captureStream(1);const a=new AudioContext();const o=a.createMediaStreamDestination();const t=o.stream.getAudioTracks()[0];s.addTrack(t);return s}
function getTime(){return new Date().toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'})}

function switchTab(t){document.querySelectorAll('.auth-tab').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.auth-form').forEach(e=>e.classList.remove('active'));document.getElementById('auth-msg').innerText="";if(t==='login'){document.querySelectorAll('.auth-tab')[0].classList.add('active');document.getElementById('login-form').classList.add('active')}else{document.querySelectorAll('.auth-tab')[1].classList.add('active');document.getElementById('register-form').classList.add('active')}}
function doRegister(){socket.emit('register',document.getElementById('reg-nick').value.trim(),document.getElementById('reg-pass').value.trim())}
function doLogin(){const u=document.getElementById('login-nick').value.trim();const p=document.getElementById('login-pass').value.trim();if(document.getElementById('remember-me').checked){localStorage.setItem('chat_user',u);localStorage.setItem('chat_pass',p)}socket.emit('login',u,p)}
function doLogout(){localStorage.removeItem('chat_user');localStorage.removeItem('chat_pass');location.reload()}
function showAuthMsg(m,t){const e=document.getElementById('auth-msg');e.innerText=m;e.className="status-msg "+t}

socket.on('auth-error',m=>showAuthMsg(m,"error"));
socket.on('register-success',m=>{showAuthMsg(m,"success");setTimeout(()=>switchTab('login'),1000)});
socket.on('login-success',u=>{myNickname=u;document.getElementById('auth-screen').style.display='none';document.getElementById('room-pass-screen').style.display='flex'});

function checkRoomPass(){const p=document.getElementById('room-pass').value;socket.emit('check-room-pass',p)}
socket.on('room-pass-success',()=>{document.getElementById('room-pass-screen').style.display='none';startChatApp()});
socket.on('room-pass-error',()=>{document.getElementById('room-error').innerText="HatalÄ± Åžifre!"});

function startChatApp(){
    document.getElementById('main-container').style.display='flex';
    currentActiveStream=getEmptyStream();
    myPeer=new Peer(undefined,{path:'/peerjs',host:location.hostname,port:location.port||(location.protocol==='https:'?443:80),config:{iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:global.stun.twilio.com:3478'}]}});
    myPeer.on('open',id=>{myPeerId=id;socket.emit('join-room',ROOM_ID,myPeerId,myNickname)});
    prepareMedia();
    document.getElementById('msg-input').addEventListener('keydown',e=>{if(e.key==='Enter')sendMessage()})
}

function toggleVideoContainer(){const c=document.getElementById('video-container');const b=document.getElementById('toggle-video-btn');if(c.classList.contains('collapsed')){c.classList.remove('collapsed');b.innerHTML='<i class="fas fa-eye"></i>'}else{c.classList.add('collapsed');b.innerHTML='<i class="fas fa-eye-slash"></i>'}}
function toggleUserList(){const l=document.getElementById('user-list-popup');l.style.display=(l.style.display==='flex')?'none':'flex'}

socket.on('update-user-list',u=>{const l=document.getElementById('user-list-content');l.innerHTML="";connectedPeerIds=[];u.forEach(x=>{userStatusMap[x.peerId]=x;if(x.peerId&&x.peerId!==myPeerId&&x.online)connectedPeerIds.push(x.peerId);const i=document.createElement('li');i.className=x.online?'online':'offline';let h='';if(x.online){if(x.cam)h+='<i class="fas fa-video media-icon" style="color:var(--ac)"></i>';if(x.screen)h+='<i class="fas fa-desktop media-icon" style="color:#3498db"></i>'}i.innerHTML=`<div class="status-dot"></div><span>${x.nickname}</span> <div class="media-icons">${h}</div>`;if(x.online&&(x.cam||x.screen)){i.onclick=()=>window.focusUserVideo(x.peerId)}l.appendChild(i)});updateVideoGrid(connectedPeerIds)});
function updateVideoGrid(peers){peers.forEach(pid=>{const el=videoElements[pid];if(el){const status=userStatusMap[pid];if(status&&(status.cam||status.screen)){el.style.display="block";if(!videoGrid.contains(el))videoGrid.append(el)}else{el.style.display="none"}}})}

window.focusUserVideo=function(p){if(p===myPeerId&&currentActiveStream){openFullscreen(currentActiveStream);return}if(userStreams[p]){openFullscreen(userStreams[p]);return}if(videoElements[p]){openFullscreen(videoElements[p].srcObject);return}alert("BaÄŸlantÄ± bekleniyor veya yayÄ±n yok.")};
function notifyMediaStatus(c,s){socket.emit('media-status',{cam:c,screen:s});if(c||s)socket.emit('stream-notify',{type:s?'screen':'camera',active:true})}
socket.on('user-stream-changed',({peerId,type})=>{const v=videoElements[peerId];if(v){if(type==='screen')v.className='screen-mode';else v.className=''}refreshConnections()});

function prepareMedia(){
    myPeer.on('call',c=>{c.answer(currentActiveStream);const v=document.createElement('video');v.setAttribute('playsinline','');v.autoplay=true;activeCalls[c.peer]=c;c.on('stream',st=>{userStreams[c.peer]=st;handleIncomingStream(st,c.peer)})});
    socket.on('user-connected',(uid,name)=>{connectToNewUser(uid);renderMessage({type:'system-status',content:`${name} sohbete giriÅŸ yaptÄ±.`,time:getTime()})});
    socket.on('user-disconnected',(uid,name)=>{if(videoElements[uid])videoElements[uid].remove();delete videoElements[uid];delete userStreams[uid];renderMessage({type:'system-status',content:`${name} sohbetten Ã§Ä±kÄ±ÅŸ yaptÄ±.`,time:getTime()})});
    myVideo.ondblclick=()=>openFullscreen(currentActiveStream)
}

function refreshConnections(){connectedPeerIds.forEach(uid=>{if(activeCalls[uid])activeCalls[uid].close();connectToNewUser(uid)})}
function connectToNewUser(uid){const c=myPeer.call(uid,currentActiveStream);const v=document.createElement('video');v.setAttribute('playsinline','');v.autoplay=true;activeCalls[uid]=c;c.on('stream',st=>{userStreams[uid]=st;handleIncomingStream(st,uid)});c.on('close',()=>{if(videoElements[uid])videoElements[uid].remove();delete videoElements[uid];delete userStreams[uid]})}

function toggleMic(){if(!cameraStream)return alert("Ã–nce Kamera/Mikrofon izni verin");const a=cameraStream.getAudioTracks()[0];const b=document.getElementById('mic-toggle-btn');a.enabled=!a.enabled;if(a.enabled){b.classList.add('active');b.innerHTML='<i class="fas fa-microphone"></i>'}else{b.classList.remove('active');b.innerHTML='<i class="fas fa-microphone-slash"></i>'}}

function toggleCamera(){if(!cameraStream){navigator.mediaDevices.getUserMedia({video:true,audio:{echoCancellation:true,noiseSuppression:true,autoGainControl:true}}).then(s=>{cameraStream=s;currentActiveStream=s;myVideo.srcObject=s;userStreams[myPeerId]=s;const micBtn = document.getElementById('mic-toggle-btn'); if(!micBtn.classList.contains('active')) { s.getAudioTracks()[0].enabled = false; } const b=document.getElementById('cam-toggle-btn');b.classList.add('active');b.innerHTML='<i class="fas fa-video-slash"></i>';if(!videoGrid.contains(myVideo))videoGrid.append(myVideo);notifyMediaStatus(true,false);socket.emit('stream-changed','camera');socket.emit('message','::SYS::'+myPeerId+'::Kamera aÃ§tÄ±');refreshConnections()}).catch(e=>{if(e.name==='NotAllowedError'||e.name==='PermissionDeniedError'){alert("LÃ¼tfen adres Ã§ubuÄŸundaki kilit ikonuna tÄ±klayÄ±p Kamera ve Mikrofon izni verin.")}else{alert("Kamera hatasÄ±: "+e)}});return}if(screenStream)stopScreenShare();const v=cameraStream.getVideoTracks()[0];v.enabled=!v.enabled;if(v.enabled){currentActiveStream=cameraStream;myVideo.srcObject=cameraStream;if(!videoGrid.contains(myVideo))videoGrid.append(myVideo);socket.emit('message','::SYS::'+myPeerId+'::Kamera aÃ§tÄ±')}else{currentActiveStream=getEmptyStream();if(videoGrid.contains(myVideo))myVideo.remove()}const b=document.getElementById('cam-toggle-btn');if(v.enabled){b.classList.add('active');b.innerHTML='<i class="fas fa-video-slash"></i>';notifyMediaStatus(true,false);socket.emit('stream-changed','camera')}else{b.classList.remove('active');b.innerHTML='<i class="fas fa-video"></i>';notifyMediaStatus(false,false)}refreshConnections()}

async function toggleScreenShare(){if(isMobile())return;if(screenStream){stopScreenShare();return}try{screenStream=await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});const m=cameraStream?cameraStream.getAudioTracks()[0]:null;if(m&&m.enabled)screenStream.addTrack(m);document.getElementById('screen-share-btn').classList.add('screen-active');currentActiveStream=screenStream;myVideo.srcObject=screenStream;myVideo.className='screen-mode';userStreams[myPeerId]=screenStream;if(!videoGrid.contains(myVideo))videoGrid.append(myVideo);notifyMediaStatus(false,true);socket.emit('stream-changed','screen');socket.emit('message','::SYS::'+myPeerId+'::Ekran paylaÅŸtÄ±');refreshConnections();screenStream.getVideoTracks()[0].onended=()=>stopScreenShare()}catch(e){}}

function stopScreenShare(){if(!screenStream)return;screenStream.getVideoTracks()[0].stop();screenStream=null;document.getElementById('screen-share-btn').classList.remove('screen-active');if(cameraStream&&cameraStream.getVideoTracks()[0].enabled){currentActiveStream=cameraStream;myVideo.srcObject=cameraStream;myVideo.className=''}else{currentActiveStream=getEmptyStream();if(videoGrid.contains(myVideo))myVideo.remove()}if(cameraStream){const c=cameraStream.getVideoTracks()[0];if(c.enabled){notifyMediaStatus(true,false);socket.emit('stream-changed','camera')}else{notifyMediaStatus(false,false)}}refreshConnections()}

function handleIncomingStream(stream,pid){let v=videoElements[pid];if(!v){v=document.createElement('video');v.setAttribute('playsinline','');v.autoplay=true;videoElements[pid]=v;v.addEventListener('loadedmetadata',()=>v.play().catch(e=>console.log(e)));v.ondblclick=()=>openFullscreen(stream)}v.srcObject=stream;const status=userStatusMap[pid];if(status&&(status.cam||status.screen)){if(!videoGrid.contains(v))videoGrid.append(v);const c=document.getElementById('video-container');if(c.classList.contains('collapsed'))toggleVideoContainer()}else{if(videoGrid.contains(v))v.remove()}}

function addVideoStream(v,pid){if(pid===myPeerId){v.muted=true;v.volume=0}if(pid&&videoElements[pid]&&videoElements[pid]!==v)videoElements[pid].remove();v.addEventListener('loadedmetadata',()=>v.play());if(pid)videoElements[pid]=v;const status=userStatusMap[pid];if(pid===myPeerId||(status&&(status.cam||status.screen))){if(!videoGrid.contains(v))videoGrid.append(v);const c=document.getElementById('video-container');if(c.classList.contains('collapsed')){toggleVideoContainer()}}v.play().catch(()=>{v.muted=true;v.play()})}

function openFullscreen(s){const v=document.getElementById('fullscreen-video');v.srcObject=s;document.getElementById('fullscreen-layer').style.display='flex';document.body.classList.add('cinema-mode');v.muted=false;v.play().catch(e=>{})}
function closeFullscreen(){const v=document.getElementById('fullscreen-video');v.muted=true;document.getElementById('fullscreen-layer').style.display='none';document.body.classList.remove('cinema-mode');document.getElementById('chat-wrapper').classList.remove('minimized');document.getElementById('notification-badge').style.display='none'}
function showImageModal(src){const m=document.getElementById('image-modal');const i=document.getElementById('modal-img');i.src=src;m.style.display='flex'}
function closeImageModal(){document.getElementById('image-modal').style.display='none'}

let isChatMinimized=false;let unreadCount=0;
function minimizeChat(e){e.stopPropagation();document.getElementById('chat-wrapper').classList.add('minimized');isChatMinimized=true}
function handleWrapperClick(){if(isChatMinimized){document.getElementById('chat-wrapper').classList.remove('minimized');isChatMinimized=false;unreadCount=0;document.getElementById('notification-badge').style.display='none'}}

function toggleInputButtons() {const val = document.getElementById('msg-input').value.trim();const sendBtn = document.getElementById('send-btn');const voiceBtn = document.getElementById('voice-msg-btn');if (val.length > 0) { sendBtn.style.display = 'flex'; voiceBtn.style.display = 'none'; }else { sendBtn.style.display = 'none'; voiceBtn.style.display = 'flex'; }}

socket.on('createMessage',d=>renderMessage(d));socket.on('load-history',h=>h.forEach(renderMessage));

function sendMessage(content){
    const inp = document.getElementById('msg-input');
    const val = content || inp.value.trim();
    if(val){socket.emit('message',val);inp.value='';toggleInputButtons();}
}

function renderMessage(d){
    if(d.senderId && d.senderId!==socket.id){ 
        if(isChatMinimized){unreadCount++;const b=document.getElementById('notification-badge');b.innerText=unreadCount;b.style.display='flex'}
        if(document.hidden && Notification.permission==="granted") new Notification("Yeni Mesaj", {body: d.user + ": " + (d.type==='text'?d.content:'Medya')});
        notifyAudio.play().catch(()=>{});
    }
    const a=document.getElementById('chat-area');const m=d.senderId===socket.id;const div=document.createElement('div');
    if(d.type==='system-status'){div.className='message system-status';div.innerHTML=`<div>${d.content}</div>`;a.appendChild(div);a.scrollTop=a.scrollHeight;return}
    div.className=`message ${m?'mine':'theirs'}`;
    if(d.type==='text' && !d.content.startsWith('::SYS::') && d.content.length <= 4 && /\p{Emoji}/u.test(d.content)) {div.classList.add('big-emoji');}
    if(d.type==='text'&&d.content.startsWith('::SYS::')){const p=d.content.split('::');div.innerHTML=`<span class="sender-name">${d.user}</span><div style="color:var(--sec);font-style:italic;">${p[3]}</div><div class="system-link-btn" onclick="window.focusUserVideo('${p[2]}')">Ä°ZLE</div><div style="font-size:10px;opacity:0.7;text-align:right;">${d.time}</div>`}else{let c=d.type==='text'?`<div>${d.content}</div>`:d.type==='image'?`<img src="${d.content}" onclick="showImageModal(this.src)">`:`<audio controls src="${d.content}"></audio>`;div.innerHTML=`<span class="sender-name" style="${m?'display:none':''}">${d.user}</span>${c}<div style="font-size:10px;opacity:0.7;text-align:right;">${d.time}</div>`}a.appendChild(div);a.scrollTop=a.scrollHeight
}

function sendImage(){const f=document.getElementById('file-input').files[0];if(f&&f.size<1e8){const r=new FileReader();r.onload=e=>socket.emit('image',e.target.result);r.readAsDataURL(f)}}
const micBtn=document.getElementById('voice-msg-btn');let mediaRec;
const startRec=e=>{if(e.cancelable)e.preventDefault();if(!navigator.mediaDevices)return;navigator.mediaDevices.getUserMedia({audio:true}).then(s=>{mediaRec=new MediaRecorder(s);const c=[];mediaRec.start();micBtn.classList.add('recording');mediaRec.ondataavailable=e=>c.push(e.data);mediaRec.onstop=()=>{const r=new FileReader();r.onloadend=()=>socket.emit('voice',r.result);r.readAsDataURL(new Blob(c,{type:'audio/webm'}));s.getTracks().forEach(t=>t.stop())}})};
const stopRec=e=>{if(e.cancelable)e.preventDefault();if(mediaRec&&mediaRec.state!=='inactive'){mediaRec.stop();micBtn.classList.remove('recording')}};
micBtn.addEventListener('mousedown',startRec);micBtn.addEventListener('mouseup',stopRec);micBtn.addEventListener('touchstart',startRec);micBtn.addEventListener('touchend',stopRec);
function scrollToBottom(){const d=document.getElementById('chat-area');d.scrollTop=d.scrollHeight}
const emojis=["ðŸ˜€","ðŸ˜‚","ðŸ˜","ðŸ˜­","ðŸ˜¡","ðŸ‘","ðŸ‘Ž","ðŸŽ‰","ðŸ”¥","â¤ï¸","ðŸ†","ðŸ‘","ðŸ‘‹","ðŸ‘€","ðŸ’©","ðŸ‘»","ðŸ’€","ðŸ¤¡","ðŸ¤¢","ðŸ¤ ","ðŸ¥¶","ðŸ¥º","ðŸ¤«","ðŸ¤”","ðŸ¥³","ðŸ¤¬"];
const emojiPicker=document.getElementById('emoji-picker');
emojis.forEach(e=>{const s=document.createElement('div');s.className='emoji-item';s.innerText=e;s.onclick=()=>{sendMessage(e);toggleEmoji()};emojiPicker.appendChild(s)});
function toggleEmoji(){emojiPicker.classList.toggle('show')}
document.addEventListener('click',e=>{if(!e.target.closest('#input-area'))emojiPicker.classList.remove('show')});

// YOUTUBE VE DÃœZELTÄ°LMÄ°Åž AYRIÅžTIRICI
function toggleYoutube(){ document.getElementById('youtube-wrapper').classList.toggle('show'); }
function loadYoutubeVideo(){
    const url = document.getElementById('yt-url-input').value;
    // GeliÅŸmiÅŸ Regex: Her tÃ¼rlÃ¼ YouTube linkini (shorts, mobile, embed, watch) tanÄ±r
    const regExp = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
    const match = url.match(regExp);
    
    if(match && match[1]) {
        const vidId = match[1];
        if(player) {
            socket.emit('yt-sync', { action: 'load', id: vidId });
        }
    } else {
        alert("LÃ¼tfen geÃ§erli bir YouTube linki girin!");
    }
}
socket.on('yt-sync', (data) => {
    if(!player) return;
    if(data.action === 'play') player.playVideo();
    else if(data.action === 'pause') player.pauseVideo();
    else if(data.action === 'load') player.loadVideoById(data.id);
    
    if(data.time && Math.abs(player.getCurrentTime() - data.time) > 2) {
        player.seekTo(data.time);
    }
});
</script>
</body>
</html>
